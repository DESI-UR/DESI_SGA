'''
Calculate the peculiar velocities of galaxies based on some independent distance 
estimator (e.g., Tully-Fisher relation).
'''

################################################################################
# Import modules
#-------------------------------------------------------------------------------
from astropy.table import Table
import astropy.constants as const
################################################################################



################################################################################
# Constants
#-------------------------------------------------------------------------------
c = const.c.to('km/s')
################################################################################



################################################################################
# Import catalog of galaxies for which to calculate the peculiar velocities
#-------------------------------------------------------------------------------
data_directory = 'SV/'

filename = 'SGA_fuji_ITFR_moduli.fits'

galaxies = Table.read(data_directory + filename)
################################################################################



################################################################################
# Compute cosmological redshift
#-------------------------------------------------------------------------------
galaxies['Z_COSMO'] = galaxies['Z_DESI'] * 10**(0.2*(galaxies['R_ABSMAG_SB26'] - galaxies['R_ABSMAG_SB26_TFbright']))

#-------------------------------------------------------------------------------
# Estimate uncertainty
#-------------------------------------------------------------------------------

#-------------------------------------------------------------------------------
################################################################################



################################################################################
# Compute peculiar redshift and velocity
#-------------------------------------------------------------------------------
galaxies['Z_PEC'] = (galaxies['Z_DESI'] - galaxies['Z_COSMO'])/(1 + galaxies['Z_COSMO'])

galaxies['V_PEC'] = c*galaxies['Z_PEC']

#-------------------------------------------------------------------------------
# Estimate uncertainties
#-------------------------------------------------------------------------------

#-------------------------------------------------------------------------------
################################################################################



################################################################################
# Save file
#-------------------------------------------------------------------------------
updated_filename = filename[:-5] + '_pec.fits'

galaxies.write(data_directory + updated_filename, format='fits', overwrite=True)
################################################################################